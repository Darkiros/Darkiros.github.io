<!DOCTYPE html>
<html lang="fr">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta charset="utf-8">
    <title>Pentest Helper - Vulnerability sheet generator</title>
    <meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport" />
    <script src="https://cdn.jsdelivr.net/gh/cvssjs/cvssjs/cvss.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.js"></script>
    <script src=https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script src="./assets/js/html2canvas.min.js"></script>

    <!-- Fonts and icons -->
    <script src="./assets/js/plugin/webfont/webfont.min.js"></script>
    <link rel="icon" href="./assets/images/icon.ico" type="image/x-icon" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script>
        WebFont.load({
            google: { families: ["Lato:300,400,700,900"] },
            custom: {
                families: [
                    "Flaticon",
                    "Font Awesome 5 Solid",
                    "Font Awesome 5 Regular",
                    "Font Awesome 5 Brands",
                    "simple-line-icons",
                ],
                urls: ["./assets/css/fonts.min.css"],
            },
            active: function () {
                sessionStorage.fonts = true;
            },
        });

        var score_cvss = 0.0;
        var image;

        window.chartColors = {
            red: 'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64)',
            yellow: 'rgb(255, 205, 86)',
            green: 'rgb(162, 213, 114)',
            blue: 'rgb(54, 162, 235)'
        };

        var color = Chart.helpers.color;

        const centerText = {
            beforeDraw: function (chart) {
                const width = chart.width
                const height = chart.height
                const ctx = chart.ctx
                ctx.restore()
                const fontSize = (height / 114).toFixed(2)
                ctx.font = 'bold ' + fontSize + 'em sans-serif'
                ctx.textBaseline = 'middle'
                ctx.fillStyle = 'white'
                ctx.strokeStyle = 'black'
                const text = score_cvss
                const textX = Math.round((width - (ctx.measureText(text).width)) / 2 - 16)
                const textY = height / 2
                ctx.fillText(text, textX, textY)
                ctx.strokeText(text, textX, textY)
                ctx.save()
            }
        }

        var config_radar = {
            type: 'radar',
            data: {
                labels: [
                    "Integrity", "Availability", "Access vector", "Attack complexity", "Privileges required", "User interaction", "Scope", "Confidentiality"],
                datasets: [{
                    label: "Score",
                    backgroundColor: color(window.chartColors.red).alpha(0.2).rgbString(),
                    borderColor: window.chartColors.red,
                    pointBackgroundColor: window.chartColors.red,
                    data: [1, 1, 1, 1, 1, 1, 1, 1],
                }]
            },
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: 'CVSS Score'
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        enabled: false
                    }
                },
                scales: {
                    r: {
                        min: -1,
                        max: 2,
                        ticks: {
                            display: false,
                            stepSize: 1
                        }
                    }
                }
            },
            plugins: [centerText]
        };


        var myRadar;

        window.onload = function () {
            myRadar = new Chart(document.getElementById("canvas"), config_radar);
        };
        var colorNames = Object.keys(window.chartColors);

        async function download(id) {
            var content = document.getElementById("vuln_description")
            content.style.color = "black";
            content = document.getElementById("vuln_step")
            content.style.color = "black";
            content = document.getElementById("vuln_impacts")
            content.style.color = "black";
            content = document.getElementById("vuln_recommandation")
            content.style.color = "black";
            var a = document.createElement("a");

            await html2canvas(document.getElementById(id)).then((canvas) => {
                a.appendChild(canvas);
            });
            var b = document.createElement("a");
            b.href = a.childNodes[0].toDataURL("");
            b.download = "Image.png";
            b.click();
            //remove a and b
            a.remove();
            b.remove();
            
            //revert
            var content = document.getElementById("vuln_description")
            content.style.color = "rgba(169, 175, 187, 0.82)";
            content = document.getElementById("vuln_step")
            content.style.color = "rgba(169, 175, 187, 0.82)";
            content = document.getElementById("vuln_impacts")
            content.style.color = "rgba(169, 175, 187, 0.82)";
            content = document.getElementById("vuln_recommandation")
            content.style.color = "rgba(169, 175, 187, 0.82)";
        }

        function SelectText(element) {
            var doc = document;
            if (doc.body.createTextRange) {
                var range = document.body.createTextRange();
                range.moveToElementText(element);
                range.select();
            } else if (window.getSelection) {
                var selection = window.getSelection();
                var range = document.createRange();
                range.selectNodeContents(element);
                selection.removeAllRanges();
                selection.addRange(range);
            }
        }

        async function copy(id) {
            var content = document.getElementById("vuln_description")
            content.style.color = "black";
            content = document.getElementById("vuln_step")
            content.style.color = "black";
            content = document.getElementById("vuln_impacts")
            content.style.color = "black";
            content = document.getElementById("vuln_recommandation")
            content.style.color = "black";

            var a = document.createElement("a");
            await html2canvas(document.getElementById(id)).then((canvas) => {
                a.appendChild(canvas);
            });
            var canvas = a.childNodes[0];
            var img = document.createElement('img');
            img.src = canvas.toDataURL()
            var div = document.createElement('div');
            div.contentEditable = true;
            div.appendChild(img);
            document.body.appendChild(div);
            // do copy
            SelectText(div);
            document.execCommand('Copy');
            document.body.removeChild(div);
            new Notify({
                status: 'success',
                title: 'Elément copié avec succès',
                text: '',
                effect: 'fade',
                speed: 300,
                customClass: '',
                customIcon: '',
                showIcon: true,
                showCloseButton: true,
                autoclose: true,
                autotimeout: 1500,
                gap: 20,
                distance: 20,
                type: 1,
                position: 'top right'
            })
            a.remove();

            //revert
            var content = document.getElementById("vuln_description")
            content.style.color = "rgba(169, 175, 187, 0.82)";
            content = document.getElementById("vuln_step")
            content.style.color = "rgba(169, 175, 187, 0.82)";
            content = document.getElementById("vuln_impacts")
            content.style.color = "rgba(169, 175, 187, 0.82)";
            content = document.getElementById("vuln_recommandation")
            content.style.color = "rgba(169, 175, 187, 0.82)";
        }

    </script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./assets/css/atlantis.min.css" />
    <link rel="stylesheet" type="text/css" media="all" href="https://cdn.jsdelivr.net/gh/cvssjs/cvssjs/cvss.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-notify@0.5.5/dist/simple-notify.min.css" />
    <link rel="stylesheet" href="./assets/css/toggle.css" />
    <script async defer src="https://buttons.github.io/buttons.js"></script>


    <style>
        .parameters {
            margin-top: 1em;
        }

        .scroll {
            overflow-x: auto;
            overflow-y: hidden;
        }

        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            margin: auto;
            width: fit-content;
            height: fit-content;
        }

        #cvssboard {
            text-align: center;
        }

        #chartjs-tooltip {
            opacity: 1;
            position: absolute;
            background: rgba(0, 0, 0, .7);
            color: white;
            border-radius: 3px;
            -webkit-transition: all .1s ease;
            transition: all .1s ease;
            pointer-events: none;
            -webkit-transform: translate(-50%, 0);
            transform: translate(-50%, 0);
        }

        #chartjs-radar {
            margin-top: 2%;
            display: inline-flex;
            margin: auto;
            text-align: center;
        }

        #vuln_pres {
            margin: auto;
            text-align: center;
        }

        .chartjs-tooltip-key {
            display: inline-block;
            width: 10px;
            height: 10px;
            margin-right: 10px;
        }

        .download,
        .copy,
        .exporter,
        .importer{
            margin-left: 3%;
            background-color: transparent;
            border: none;
            height: fit-content;
            margin-top: 1em;
            margin-bottom: auto;
            color: white;
        }

        .exporter,
        .importer {
            margin-top: 1em;
        }

        .download:hover,
        .copy:hover,
        .exporter:hover,
        .importer:hover {
            cursor: pointer;
            color: blue;
        }

        .center-box {
            margin: auto;
            text-align: center;
        }

        .table {
            margin: auto;
            border-collapse: collapse;
        }

        .table th {
            padding: 5px;
            color: white;
            background-color: #6c7ae0;
            text-align: center;
            height: 3em;
        }

        .table td {
            padding: 5px;
            text-align: center;
            background-color: whitesmoke;
            font-weight: bold;
            height: 3em;
        }

        dd > label {
            color: black !important;
        }
    </style>

</head>


<body data-background-color="dark">
    <div class="wrapper">
        <div class="main-header">
            <!-- Logo Header -->
            <div class="logo-header" data-background-color="dark2">
                <a href="./index.html" class="logo">
                    <img src="./assets/images/logo.png" alt="navbar brand" class="navbar-brand" width="70px" />
                </a>
                <button class="navbar-toggler sidenav-toggler ml-auto" type="button" data-toggle="collapse"
                    data-target="collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon">
                        <i class="icon-menu"></i>
                    </span>
                </button>
                <button class="topbar-toggler more">
                    <i class="icon-options-vertical"></i>
                </button>
                <div class="nav-toggle">
                    <button class="btn btn-toggle toggle-sidebar">
                        <i class="icon-menu"></i>
                    </button>
                </div>
            </div>
            <!-- End Logo Header -->

            <!-- Navbar Header -->
            <nav class="navbar navbar-header navbar-expand-lg" data-background-color="dark">
                <div class="container-fluid">

                    <div style="margin-left: auto; color: white;">
                        <h2 class="text-center">Vulnerability sheet generator</h1>
                    </div>

                    <ul class="navbar-nav topbar-nav ml-md-auto align-items-center">
                        <li class="nav-item hidden-caret">
                            <a class="github-button" href="https://github.com/Darkiros/Darkiros.github.io" data-color-scheme="no-preference: dark; light: light; dark: dark;" data-show-count="true" data-icon="octicon-star" data-size="large" aria-label="Star Darkiros/Darkiros.github.io on GitHub">
                              Star
                            </a>
                        </li>
                        <li class="nav-item dropdown hidden-caret">
                            <a class="dropdown-toggle profile-pic" data-toggle="dropdown" href="#"
                                aria-expanded="false">
                                <div class="avatar-sm">
                                    <img src="./assets/images/Darkiros.jpg" alt="..."
                                        class="avatar-img rounded-circle" />
                                </div>
                            </a>
                            <ul class="dropdown-menu dropdown-user animated fadeIn">
                                <div class="dropdown-user-scroll scrollbar-outer">
                                    <li>
                                        <div class="user-box">
                                            <div class="avatar-lg ml-auto mr-auto">
                                                <img src="./assets/images/Darkiros.jpg" alt="image profile"
                                                    class="avatar-img rounded" />
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" href="https://github.com/Darkiros" target="_blank"
                                            rel="noopener noreferrer">
                                            <div class="avatar-sm ml-auto mr-auto">
                                                <img src="./assets/images/github.png" alt="Github Darkiros"
                                                    class="avatar-img rounded-circle">
                                            </div>
                                        </a>
                                        <p class="text-center dropdown-header">Made by Darkiros</p>
                                    </li>
                                </div>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
            <!-- End Navbar -->
        </div>

        <div class="sidebar sidebar-style-2" data-background-color="dark2">
            <div class="sidebar-wrapper scrollbar scrollbar-inner">
                <div class="sidebar-content">
                    <ul class="nav nav-primary">
                        <li class="nav-item">
                            <a href="./index.html">
                                <i class="fas fa-home"></i>
                                <p>Home</p>
                            </a>
                        </li>
                        <li class="nav-section">
                            <span class="sidebar-mini-icon">
                                <i class="fa fa-ellipsis-h"></i>
                            </span>
                        </li>
                        <li class="nav-item">
                            <a data-toggle="collapse" href="#sheet">
                              <i class="fas fa-book"></i>
                              <p>Cheat sheet</p>
                              <span class="caret"></span>
                            </a>
                            <div class="collapse" id="sheet">
                              <ul class="nav nav-collapse ">
                                <li>
                                  <a href="./commands.html">
                                    <span class="sub-item">Command list</span>
                                  </a>
                                </li>
                              </ul>
                            </div>
                        </li>
                        <li class="nav-item active submenu">
                            <a data-toggle="collapse" href="#rapports" aria-expanded="true">
                                <i class="fas fa-wrench"></i>
                                <p>Tools</p>
                                <span class="caret"></span>
                            </a>
                            <div class="collapse show" id="rapports">
                                <ul class="nav nav-collapse">
                                    <li>
                                        <a href="./calculatrice.html">
                                            <span class="sub-item">CVSS 3.1 calculator</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="./graphs.html">
                                            <span class="sub-item">Graphs generator</span>
                                        </a>
                                    </li>
                                    <li class="active">
                                        <a href="./generateur_vuln.html">
                                            <span class="sub-item">Vulnerability sheet generator</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a data-toggle="collapse" href="#project">
                                <i class="fas fa-list"></i>
                                <p>Pentest report</p>
                                <span class="caret"></span>
                            </a>
                            <div class="collapse" id="project">
                                <ul class="nav nav-collapse ">
                                    <li>
                                        <a href="./project.html">
                                            <span class="sub-item">Project</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- End Sidebar -->

        <div class="main-panel" style="margin-top: 6em;">
            <div class="content">
                <div class="page-inner">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                       <div class="form-group" style="width: 100%;">
                                            <div class="input-group">
                                                <h3 class="input-group-text" style="width: 17em;">Vulnerability name</h3>
                                                <input type="text" id="name" class="form-control" onkeyup="fill_vuln()"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group" style="width: 100%;">
                                            <div class="input-group">
                                                <h3 class="input-group-text" style="width: 17em;">Description</h3>
                                                <textarea id="description" class="form-control scroll" style="height: fit-content; min-height: 10em;"
                                                oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"'></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group" style="width: 100%;">
                                            <div class="input-group">
                                                <h3 class="input-group-text" style="width: 17em;">Steps to reproduce</h3>
                                                <textarea id="step" class="form-control scroll" style="height: fit-content; min-height: 10em;"
                                                oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"'></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group" style="width: 100%;">
                                            <div class="input-group">
                                                <h3 class="input-group-text" style="width: 17em;">Impact</h3>
                                                <textarea id="impacts" class="form-control scroll" style="height: fit-content; min-height: 6em;"
                                                oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"'></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mt-3 mb-3">
                                        <div id="cvssboard" style="color: black;"></div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group" style="width: 100%;">
                                            <div class="input-group">
                                                <h3 class="input-group-text" style="width: 17em;">Recommandations</h3>
                                                <textarea id="recommandation" class="form-control scroll" style="height: fit-content; min-height: 6em;"
                                                oninput='this.style.height = "";this.style.height = this.scrollHeight + "px"'></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mt-1">
                                        <div class="center-box">
                                            <div style="width: 100%; display: inline-flex;">
                                                <span>EN</span>
                                                <input type="checkbox" id="switch" onclick="change_language()"/>
                                                <label style="margin-right: 1%;" class="switch" for="switch">Toggle</label>
                                                <span>FR</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card-body" style="border-left: solid; border-left-color: #6c7ae0; padding-left: 1%; padding-top: 0; padding-bottom: 0;" id="fiche">
                                <h2 style="text-transform: uppercase; text-decoration: underline; color: #6c7ae0;" id="vuln_name">Vulnerability name</h2>
                                <h5 id="description_title" style="text-transform: uppercase; color: #6c7ae0; margin-bottom: 0;">Description :</h5>
                                <p id="vuln_description"></p>
                                <h5 id="step_title" style="text-transform: uppercase; color: #6c7ae0; margin-bottom: 0;">Steps to reproduce :</h5>
                                <p id="vuln_step"></p>
                                <h5 id="impact_title" style="text-transform: uppercase; color: #6c7ae0; margin-bottom: 0;">Impact :</h5>
                                <p id="vuln_impacts"></p>
                                <h5 id="evaluation_title" style="text-transform: uppercase; color: #6c7ae0; margin-bottom: 0;">Risk evaluation :</h5>
                                <div id="metrics">
                                    <table class="table" id="metricsTable">
                                        <tr>
                                            <th id="exploitability_table">Exploitability</th>
                                            <th id="impact_table">Impact</th>
                                            <th id="risk_table">Rissk</th>
                                        </tr>
                                        <tr>
                                            <td id="exploitability">0</td>
                                            <td id="impact">0</td>
                                            <td id="risk">0</td>
                                        </tr>
                                    </table>
                                </div>
                                <h5 id="cvss_title" style="text-transform: uppercase; color: #6c7ae0; margin-bottom: 0;">CVSS 3.1 evaluation :</h5>
                                <div class="center-box">
                                    <div id="chartjs-radar">
                                        <canvas id="canvas">
                                        </canvas>
                                    </div>
                                </div>
                                <h5 id="recommandation_title" style="text-transform: uppercase; color: #6c7ae0; margin-bottom: 0;">Recommandations :</h5>
                                <p id="vuln_recommandation"></p>
                            </div>
                            <div class="center-box">
                                <button class="btn btn-primary download" onclick="download('fiche')" style="width:160px">Download</button>
                                <button class="btn btn-primary copy" onclick="copy('fiche')" style="width:160px">Copy</button>
                            </div>
                            <div class="center-box">
                                <button class="btn btn-primary exporter" onclick="exporter()" style="width:160px">Export</button>
                                <button class="btn btn-primary importer" onclick="importer()" style="width:160px">Import</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- End Custom template -->
    </div>
    <!--   Core JS Files   -->
    <script src="./assets/js/core/jquery.3.2.1.min.js"></script>
    <script src="./assets/js/core/popper.min.js"></script>
    <script src="./assets/js/core/bootstrap.min.js"></script>

    <!-- jQuery UI -->
    <script src="./assets/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
    <script src="./assets/js/plugin/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js"></script>

    <!-- jQuery Scrollbar -->
    <script src="./assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>

    <!-- jQuery Sparkline -->
    <script src="./assets/js/plugin/jquery.sparkline/jquery.sparkline.min.js"></script>

    <!-- Chart Circle -->
    <script src="./assets/js/plugin/chart-circle/circles.min.js"></script>

    <!-- Datatables -->
    <script src="./assets/js/plugin/datatables/datatables.min.js"></script>

    <!-- Bootstrap Notify -->
    <script src="./assets/js/plugin/bootstrap-notify/bootstrap-notify.min.js"></script>

    <!-- jQuery Vector Maps -->
    <script src="./assets/js/plugin/jqvmap/jquery.vmap.min.js"></script>
    <script src="./assets/js/plugin/jqvmap/maps/jquery.vmap.world.js"></script>

    <!-- Sweet Alert -->
    <script src="./assets/js/plugin/sweetalert/sweetalert.min.js"></script>

    <!-- Atlantis JS -->
    <script src="./assets/js/atlantis.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.halo.min.js"></script>

    <!-- Init to check the space required -->
    <script src="./assets/js/init.js"></script>
</body>

<script>

    function exporter() {
        var vuln_name = document.getElementById("name").value;
        var vuln_description = document.getElementById("description").value;
        var vuln_step = document.getElementById("step").value;
        var vuln_impacts = document.getElementById("impacts").value;
        var exploitability = document.getElementById("exploitability").innerHTML;
        var impact = document.getElementById("impact").innerHTML;
        var risk = document.getElementById("risk").innerHTML;
        var vuln_cvss = c.get().vector;
        var vuln_recommandation = document.getElementById("recommandation").value;
        var data = {
            "vuln_name": vuln_name,
            "vuln_description": vuln_description,
            "vuln_step": vuln_step,
            "vuln_impacts": vuln_impacts,
            "poc": [],
            "exploitability": exploitability,
            "impact": impact,
            "risk": risk,
            "vuln_cvss": vuln_cvss,
            "vuln_recommandation": vuln_recommandation
        }
        vuln_name = vuln_name.replace(/\s/g, "_");
        var filename = vuln_name + ".json";
        var blob = new Blob([JSON.stringify(data)], { type: "application/json" });
        saveAs(blob, filename);
    }

    function importer() {
        var input = document.createElement('input');
        input.type = 'file';
        input.onchange = e => {
            var file = e.target.files[0];
            var reader = new FileReader();
            reader.readAsText(file, 'UTF-8');
            reader.onload = readerEvent => {
                var content = readerEvent.target.result;
                var data = JSON.parse(content);
                
                document.getElementById("name").value = data.vuln_name;
                document.getElementById("vuln_name").innerHTML = data.vuln_name;
                
                document.getElementById("description").value = data.vuln_description;
                document.getElementById("vuln_description").innerHTML = data.vuln_description.replace(/\n\r?/g, "<br>");
                
                document.getElementById("step").value = data.vuln_step;
                document.getElementById("vuln_step").innerHTML = data.vuln_step.replace(/\n\r?/g, "<br>");

                document.getElementById("impacts").value = data.vuln_impacts;
                document.getElementById("vuln_impacts").innerHTML = data.vuln_impacts.replace(/\n\r?/g, "<br>");

                document.getElementById("exploitability").innerHTML = data.exploitability;
                document.getElementById("impact").innerHTML = data.impact;
                document.getElementById("risk").innerHTML = data.risk;

                c.set(data.vuln_cvss);

                document.getElementById("recommandation").value = data.vuln_recommandation;
                document.getElementById("vuln_recommandation").innerHTML = data.vuln_recommandation.replace(/\n\r?/g, "<br>");
            }
        }
        input.click();
    }

    function saveAs(blob, filename) {
        var url = URL.createObjectURL(blob);
        var a = document.createElement("a");
        a.href = url;
        a.download = filename || 'download';
        var clickHandler = function () {
            setTimeout(function () {
                URL.revokeObjectURL(url);
                this.removeEventListener('click', clickHandler);
            }, 150);
        };
        a.addEventListener('click', clickHandler, false);
        a.click();
        return a;
    }

    function change_language() {
        if (!document.getElementById("switch").checked) {
            if (document.getElementById("name").value == "") {
                document.getElementById("vuln_name").innerHTML = "Vulnerability name";
            }
            document.getElementById("description_title").innerHTML = "Description :";
            document.getElementById("step_title").innerHTML = "Steps to reproduce :";
            document.getElementById("impact_title").innerHTML = "Impact :";
            document.getElementById("evaluation_title").innerHTML = "Risk evaluation :";
            document.getElementById("exploitability_table").innerHTML = "Exploitability";
            document.getElementById("impact_table").innerHTML = "Impact";
            document.getElementById("risk_table").innerHTML = "Risk";
            document.getElementById("cvss_title").innerHTML = "CVSS 3.1 evaluation :";
            document.getElementById("exploitability_table").innerHTML = "Exploitability";
            document.getElementById("impact_table").innerHTML = "Impact";
            document.getElementById("risk_table").innerHTML = "Risk";

            labels = ["Integrity", "Availability", "Access vector", "Attack complexity", "Privileges required", "User interaction", "Scope", "Confidentiality"];
            myRadar.data.labels = labels;
        }
        else {
            if (document.getElementById("name").value == "") {
                document.getElementById("vuln_name").innerHTML = "Nom de la vulnérabilité";
            }
            document.getElementById("step_title").innerHTML = "Etapes pour reproduire le résultat :";
            document.getElementById("impact_title").innerHTML = "Impact :";
            document.getElementById("evaluation_title").innerHTML = "Evaluation du risque :";
            document.getElementById("exploitability_table").innerHTML = "Exploitabilité";
            document.getElementById("impact_table").innerHTML = "Impact";
            document.getElementById("risk_table").innerHTML = "Risque";
            document.getElementById("cvss_title").innerHTML = "Evaluation CVSS 3.1 :";

            labels = ["Intégrité", "Disponibilité", "Vecteur d'accès", "Complexité de l'attaque", "Privilèges requis", "Interaction utilisateur", "Portée", "Confidentialité"];
            myRadar.data.labels = labels;
        }
        action();
    }

    function fill_vuln() {
        vuln_name = document.getElementById("vuln_name");

        vuln_name.innerHTML = document.getElementById("name").value;
        if (vuln_name.innerHTML == "") {
            vuln_name.innerHTML = "Nom de la vulnérabilité";
        }
    }

    var step = document.getElementById("step");
    var description = document.getElementById("description");
    var impacts = document.getElementById("impacts");
    var recommandation = document.getElementById("recommandation");
    

    function listener_step(evt){
        vuln_step = document.getElementById("vuln_step");
        vuln_step.innerHTML = this.value.replace(/\n\r?/g, "<br>");
    }

    function listener_description(evt){
        vuln_description = document.getElementById("vuln_description");
        vuln_description.innerHTML = this.value.replace(/\n\r?/g, "<br>");
    }

    function listener_impacts(evt){
        vuln_impacts = document.getElementById("vuln_impacts");
        vuln_impacts.innerHTML = this.value.replace(/\n\r?/g, "<br>");
    }

    function listener_recommandation(evt){
        vuln_recommandation = document.getElementById("vuln_recommandation");
        vuln_recommandation.innerHTML = this.value.replace(/\n\r?/g, "<br>");
    }
        
    step.addEventListener("keyup", listener_step, false);
    description.addEventListener("keyup", listener_description, false);
    impacts.addEventListener("keyup", listener_impacts, false);
    recommandation.addEventListener("keyup", listener_recommandation, false);

    var roundUp1 = function Roundup(input) {
        var int_input = Math.round(input * 100000);
        if (int_input % 10000 === 0) {
            return int_input / 100000
        } else {
            return (Math.floor(int_input / 10000) + 1) / 10
        }
    };

    var c = new CVSS("cvssboard", {
        onchange: function () {
            window.location.hash = c.get().vector;
            c.vector.setAttribute('href', '#' + c.get().vector)
            action()
        }
    });
    if (window.location.hash.substring(1).length > 0) {
        c.set(decodeURIComponent(window.location.hash.substring(1)));
    }



    function action() {
        console.clear();
        var tmp = c.get().vector.split("/");
        var score = { "AV": 0, "AC": 0, "PR": 0, "UI": 0, "S": 0, "C": 0, "I": 0, "A": 0 };
        var radar_point = { "AV": 0, "AC": 0, "PR": 0, "UI": 0, "S": 0, "C": 0, "I": 0, "A": 0 };
        for (let index = 1; index < tmp.length; index++) {
            var type = tmp[index].split(":")[0];
            var selection = tmp[index].split(":")[1];
            switch (type) {
                case "AV":
                    switch (selection) {
                        case "N":
                            score[type] = 0.85;
                            radar_point[type] = 2;
                            break;
                        case "A":
                            score[type] = 0.62;
                            radar_point[type] = 1;
                            break;
                        case "L":
                            score[type] = 0.55;
                            radar_point[type] = 0;
                            break;
                        case "P":
                            score[type] = 0.2;
                            radar_point[type] = 0;
                            break;
                        default:
                            break;
                    }
                    break;
                case "AC":
                    switch (selection) {
                        case "H":
                            score[type] = 0.44;
                            radar_point[type] = 0;
                            break;
                        case "L":
                            score[type] = 0.77;
                            radar_point[type] = 2;
                            break;
                        default:
                            break;
                    }
                    break;
                case "PR":
                    switch (selection) {
                        case "N":
                            score[type] = "N";
                            radar_point["PR"] = 2;
                            break;
                        case "L":
                            score[type] = "L";
                            radar_point["PR"] = 1;
                            break;
                        case "H":
                            score[type] = "H";
                            radar_point["PR"] = 0;
                            break;
                        default:
                            break;
                    }
                case "UI":
                    switch (selection) {
                        case "N":
                            score[type] = 0.85;
                            radar_point[type] = 2;
                            break;
                        case "R":
                            score[type] = 0.62;
                            radar_point[type] = 0;
                            break;
                        default:
                            break;
                    }
                    break;
                case "S":
                    switch (selection) {
                        case "U":
                            score[type] = 6.42;
                            radar_point[type] = 0;
                            break;
                        case "C":
                            score[type] = 7.52;
                            radar_point[type] = 2;
                        default:
                            break;
                    }
                    break;
                case "C":
                case "I":
                case "A":
                    switch (selection) {
                        case "N":
                            score[type] = 0.0;
                            radar_point[type] = 0;
                            break;
                        case "L":
                            score[type] = 0.22;
                            radar_point[type] = 1;
                            break;
                        case "H":
                            score[type] = 0.56;
                            radar_point[type] = 2;
                            break;
                        default:
                            break;
                    }
                    break;
                default:
                    break;
            }

        }

        if (score["S"] == 6.42) {
            switch (score["PR"]) {
                case "N":
                    score["PR"] = 0.85;
                    break;
                case "L":
                    score["PR"] = 0.62;
                    break;
                case "H":
                    score["PR"] = 0.27;
                    break;
                default:
                    break;
            }
        }
        else {
            switch (score["PR"]) {
                case "N":
                    score["PR"] = 0.85;
                    break;
                case "L":
                    score["PR"] = 0.68;
                    break;
                case "H":
                    score["PR"] = 0.5;
                    break;
                default:
                    break;
            }
        }

        score_cvss = c.get().score;

        var impact = 1 - (1 - score["C"]) * (1 - score["I"]) * (1 - score["A"])
        if (score["S"] == 6.42) {
            impact = 6.42 * impact;
        }
        else {
            impact = 7.52 * (impact - 0.029) - 3.25 * Math.pow((impact - 0.02), 15);
        }

        var exploitability = 8.22 * score["AV"] * score["AC"] * score["PR"] * score["UI"];


        impact = Math.round(impact * 10) / 10

        var impact_metric = impact;
        console.log("impact : " + impact)

        if (impact <= 2.5) {
            if (!document.getElementById("switch").checked) {
                impact = "Minor"
            }
            else {
                impact = "Mineur"
            }
            document.getElementById("impact").style.color = window.chartColors.green
        }
        else if (impact > 2.5 && impact <= 4) {
            impact = "Important"
            document.getElementById("impact").style.color = window.chartColors.yellow
        }
        else if (impact > 4 && impact <= 5.5) {
            if (!document.getElementById("switch").checked) {
                impact = "Major"
            }
            else {
                impact = "Majeur"
            }
            document.getElementById("impact").style.color = window.chartColors.orange
        }
        else {
            if (!document.getElementById("switch").checked) {
                impact = "Critical"
            }
            else {
                impact = "Critique"
            }
            document.getElementById("impact").style.color = window.chartColors.red
        }

        document.getElementById("impact").innerHTML = impact + " " + impact_metric;
        console.log("impact : " + impact)

        exploitability = Math.round(exploitability * 10) / 10

        var exploitability_metric = exploitability;
        console.log("exploitability : " + exploitability)

        if (score["S"] == 6.42 && exploitability == 4) {
            exploitability = exploitability - 1
        }

        virt_exploitability = exploitability

        if (exploitability <= 1) {
            if (!document.getElementById("switch").checked) {
                exploitability = "Very hard"
            }
            else {
                exploitability = "Difficile"
            }
            document.getElementById("exploitability").style.color = window.chartColors.green
        }
        else if (exploitability > 1 && exploitability <= 2) {
            if (!document.getElementById("switch").checked) {
                exploitability = "Hard"
            }
            else {
                exploitability = "Elevée"
            }
            document.getElementById("exploitability").style.color = window.chartColors.yellow
        }
        else if (exploitability > 2 && exploitability <= 3) {
            if (!document.getElementById("switch").checked) {
                exploitability = "Medium"
            }
            else {
                exploitability = "Moyen"
            }
            document.getElementById("exploitability").style.color = window.chartColors.orange
        }
        else {
            if (!document.getElementById("switch").checked) {
                exploitability = "Easy"
            }
            else {
                exploitability = "Facile"
            }
            document.getElementById("exploitability").style.color = window.chartColors.red
        }

        document.getElementById("exploitability").innerHTML = exploitability + " " + exploitability_metric;
        console.log("exploitability : " + exploitability)


        const risk_matrix_fr = {
            "Mineur": { "Difficile": "Mineur", "Elevée": "Mineur", "Moyen": "Important", "Facile": "Important" },
            "Important": { "Difficile": "Mineur", "Elevée": "Important", "Moyen": "Important", "Facile": "Majeur" },
            "Majeur": { "Difficile": "Important", "Elevée": "Important", "Moyen": "Majeur", "Facile": "Critique" },
            "Critique": { "Difficile": "Important", "Elevée": "Majeur", "Moyen": "Critique", "Facile": "Critique" }
        }
        const risk_matrix_en = {
            "Minor": { "Very hard": "Minor", "Hard": "Minor", "Medium": "Important", "Easy": "Important" },
            "Important": { "Very hard": "Minor", "Hard": "Important", "Medium": "Important", "Easy": "Major" },
            "Major": { "Very hard": "Important", "Hard": "Important", "Medium": "Major", "Easy": "Critical" },
            "Critical": { "Very hard": "Important", "Hard": "Major", "Medium": "Critical", "Easy": "Critical" }
        }

        var risk_matrix;

        if (!document.getElementById("switch").checked) {
            risk_matrix = risk_matrix_en
        }
        else {
            risk_matrix = risk_matrix_fr
        }
        var risk = risk_matrix[impact][exploitability]

        document.getElementById("risk").innerHTML = risk;
        if (risk == "Mineur" || risk == "Minor") {
            document.getElementById("risk").style.color = window.chartColors.green
        }
        else if (risk == "Important") {
            document.getElementById("risk").style.color = window.chartColors.yellow
        }
        else if (risk == "Majeur" || risk == "Major") {
            document.getElementById("risk").style.color = window.chartColors.orange
        }
        else {
            document.getElementById("risk").style.color = window.chartColors.red
        }

        console.log("risk : " + risk)

        config_radar.data.datasets[0].data[0] = radar_point["I"];
        config_radar.data.datasets[0].data[1] = radar_point["A"];
        config_radar.data.datasets[0].data[2] = radar_point["AV"];
        config_radar.data.datasets[0].data[3] = radar_point["AC"];
        config_radar.data.datasets[0].data[4] = radar_point["PR"];
        config_radar.data.datasets[0].data[5] = radar_point["UI"];
        config_radar.data.datasets[0].data[6] = radar_point["S"];
        config_radar.data.datasets[0].data[7] = radar_point["C"];

        if (score_cvss <= 3.9) {
            config_radar.data.datasets[0].backgroundColor = color(window.chartColors.green).alpha(0.2).rgbString(),
                config_radar.data.datasets[0].borderColor = window.chartColors.green,
                config_radar.data.datasets[0].pointBackgroundColor = window.chartColors.green
        }
        else if (score_cvss >= 4 && score_cvss <= 6.9) {
            config_radar.data.datasets[0].backgroundColor = color(window.chartColors.yellow).alpha(0.2).rgbString(),
                config_radar.data.datasets[0].borderColor = window.chartColors.yellow,
                config_radar.data.datasets[0].pointBackgroundColor = window.chartColors.yellow
        }
        else if (score_cvss >= 7 && score_cvss <= 8.9) {
            config_radar.data.datasets[0].backgroundColor = color(window.chartColors.orange).alpha(0.2).rgbString(),
                config_radar.data.datasets[0].borderColor = window.chartColors.orange,
                config_radar.data.datasets[0].pointBackgroundColor = window.chartColors.orange
        }
        else {
            config_radar.data.datasets[0].backgroundColor = color(window.chartColors.red).alpha(0.2).rgbString(),
                config_radar.data.datasets[0].borderColor = window.chartColors.red,
                config_radar.data.datasets[0].pointBackgroundColor = window.chartColors.red
        }

        if (score["S"] == 6.42) {
            exploitability = virt_exploitability + 1
        }

        if (exploitability <= 1) {
            exploitability = "Difficile"
        }
        else if (exploitability > 1 && exploitability <= 2) {
            exploitability = "Elevee"
        }
        else if (exploitability > 2 && exploitability <= 3) {
            exploitability = "Moyen"
        }
        else {
            exploitability = "Facile"
        }

        myRadar.update()

    }


</script>

</html>
